/*
enchant.js v0.5.0
Copyright (c) Ubiquitous Entertainment Inc.
Dual licensed under the MIT or GPL Version 3 licenses
http://www.opensource.org/licenses/mit-license.php
http://www.gnu.org/licenses/gpl-3.0.html
*/
"function"!=typeof Object.defineProperty&&(Object.defineProperty=function(f,l,h){"value"in h&&(f[l]=h.value);"get"in h&&f.__defineGetter__(l,h.get);"set"in h&&f.__defineSetter__(l,h.set);return f});"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(f,l){for(var h in l)l.hasOwnProperty(h)&&Object.defineProperty(f,h,l[h]);return f});
"function"!=typeof Object.create&&(Object.create=function(f,l){function h(){}h.prototype=f;var m=new h;l!=null&&Object.defineProperties(m,l);return m});"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(f){return f.__proto__});
"function"!==typeof Function.prototype.bind&&(Function.prototype.bind=function(f){var l=this,h=Array.prototype.slice.call(arguments,1),m=function(){},o=function(){var o=h.concat(Array.prototype.slice.call(arguments));return l.apply(this instanceof m?this:f||window,o)};m.prototype=l.prototype;o.prototype=new m;return o});
var enchant=function(f){if(f!=null){f instanceof Array||(f=Array.prototype.slice.call(arguments));f=f.filter(function(f){return""+f})}(function h(m,o){var r=[],p;for(p in m)if(m.hasOwnProperty(p))if(typeof m[p]=="function")window[p]=m[p];else if(typeof m[p]=="object"&&Object.getPrototypeOf(m[p])==Object.prototype)if(f==null)r.push(p);else{e=f.indexOf(o+p);if(e!=-1){r.push(p);f.splice(e,1)}}var e=0;for(p=r.length;e<p;e++)h(m[r[e]],o+r[e]+".")})(enchant,"");if(f!=null&&f.length)throw Error("Cannot load module: "+
f.join(", "));};
(function(){function f(a){var b=a.match(/\.\w+$/);return b&&b.length>0?b[0].slice(1).toLowerCase():a.indexOf("data:")===0?a.split(/[\/;]/)[1].toLowerCase():null}var l=enchant,h;h=navigator.userAgent;h=h.indexOf("Opera")!=-1?"O":h.indexOf("MSIE")!=-1?"ms":h.indexOf("WebKit")!=-1?"webkit":navigator.product=="Gecko"?"Moz":"";var m;m=document.createElement("div");m.setAttribute("ontouchstart","return");m=typeof m.ontouchstart=="function";var o;if(navigator.userAgent.indexOf("iPhone")!=-1&&window.devicePixelRatio==
2){o=document.querySelector('meta[name="viewport"]');if(o==null){o=document.createElement("meta");document.head.appendChild(o)}o.setAttribute("content","width=640");o=true}else o=false;var r;r=navigator.userAgent;var p=navigator.vendor||"";r=location.href.indexOf("http")==0&&r.indexOf("Mobile")==-1&&p.indexOf("Apple")!=-1;l.ENV={VENDOR_PREFIX:h,TOUCH_ENABLED:m,RETINA_DISPLAY:o,USE_FLASH_SOUND:r,USE_DEFAULT_EVENT_TAGS:["input","textarea","select"]};var e;enchant.Class=function(a,b){return enchant.Class.create(a,
b)};enchant.Class.create=function(a,b){if(arguments.length==0)return enchant.Class.create(Object,b);if(arguments.length==1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var d in b)if(b.hasOwnProperty(d))if(typeof b[d]=="object"&&Object.getPrototypeOf(b[d])==Object.prototype){if(!("enumerable"in b[d]))b[d].enumerable=true}else b[d]={value:b[d],enumerable:true,writable:true};var c=function(){if(this instanceof c)c.prototype.initialize.apply(this,arguments);else return new c};
c.prototype=Object.create(a.prototype,b);c.prototype.constructor=c;if(c.prototype.initialize==null)c.prototype.initialize=function(){a.apply(this,arguments)};return c};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){this.x=this.localX=(a-e._pageX)/e.scale;this.y=this.localY=(b-e._pageY)/e.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";
enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";
enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP=
"bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var d=this._listeners[a];d==null?this._listeners[a]=[b]:d.indexOf(b)==-1&&d.unshift(b)},removeEventListener:function(a,b){var d=this._listeners[a];if(d!=null){var c=d.indexOf(b);c!=-1&&d.splice(c,1)}},clearEventListener:function(a){a!=null?delete this._listeners[a]:this._listeners={}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;
if(this["on"+a.type]!=null)this["on"+a.type](a);var b=this._listeners[a.type];if(b!=null)for(var b=b.slice(),d=0,c=b.length;d<c;d++)b[d].call(this,a)}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){if(window.document.body===null)throw Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var d=true;if(e){d=false;e.stop()}e=enchant.Game.instance=this;this.width=a||320;this.height=b||320;this.scale=1;var c=document.getElementById("enchant-stage");
if(c){var g=window.getComputedStyle(c),a=parseInt(g.width),b=parseInt(g.height);if(a&&b)this.scale=Math.min(a/this.width,b/this.height);else{c.style.width=this.width+"px";c.style.height=this.height+"px"}for(;c.firstChild;)c.removeChild(c.firstChild);c.style.position="relative";g=c.getBoundingClientRect();this._pageX=Math.round(window.scrollX+g.left);this._pageY=Math.round(window.scrollY+g.top)}else{c=document.createElement("div");c.id="enchant-stage";c.style.width=window.innerWidth+"px";c.style.height=
window.innerHeight+"px";c.style.position="absolute";document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c);this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageY=this._pageX=0}if(!this.scale)this.scale=1;c.style.fontSize="12px";c.style.webkitTextSizeAdjust="none";this._element=c;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var n=this._assets=[];(function D(a){a.assets instanceof
Array&&[].push.apply(n,a.assets);for(var b in a)a.hasOwnProperty(b)&&typeof a[b]=="object"&&Object.getPrototypeOf(a[b])==Object.prototype&&D(a[b])})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var k=this.width*0.9|0,q=this.width*0.3|0,i=k*0.05|0,c=new enchant.Sprite(k,q);c.x=(this.width-k)/2;c.y=(this.height-q)/2;var j=new enchant.Surface(k,q);j.context.fillStyle=
"#fff";j.context.fillRect(0,0,k,q);j.context.fillStyle="#000";j.context.fillRect(i,i,k-i*2,q-i*2);c.image=j;var f=0,h=0;this.addEventListener("progress",function(a){f=a.loaded/a.total});c.addEventListener("enterframe",function(){h=h*0.9;h=h+f*0.1;j.context.fillStyle="#fff";j.context.fillRect(i,0,(k-i*2)*h,q)});this.loadingScene.addChild(c);this._soundID=this._surfaceID=this._mousedownID=0;this._intervalID=null;this._offsetY=this._offsetX=0;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,
"up");this.keybind(39,"right");this.keybind(40,"down");var l=0;["left","right","up","down","a","b"].forEach(function(a){this.addEventListener(a+"buttondown",function(b){var c;if(!this.input[a]){this.input[a]=true;c=new enchant.Event(l++?"inputchange":"inputstart");this.dispatchEvent(c)}this.currentScene.dispatchEvent(b);c&&this.currentScene.dispatchEvent(c)});this.addEventListener(a+"buttonup",function(b){var c;if(this.input[a]){this.input[a]=false;c=new enchant.Event(--l?"inputchange":"inputend");
this.dispatchEvent(c)}this.currentScene.dispatchEvent(b);c&&this.currentScene.dispatchEvent(c)})},this);if(d){c=enchant.Game.instance._element;document.addEventListener("keydown",function(a){e.dispatchEvent(new enchant.Event("keydown"));if(37<=a.keyCode&&a.keyCode<=40||a.keyCode==32){a.preventDefault();a.stopPropagation()}if(e.running)if(a=e._keybind[a.keyCode]){a=new enchant.Event(a+"buttondown");e.dispatchEvent(a)}},true);document.addEventListener("keyup",function(a){if(e.running)if(a=e._keybind[a.keyCode]){a=
new enchant.Event(a+"buttonup");e.dispatchEvent(a)}},true);if(enchant.ENV.TOUCH_ENABLED){c.addEventListener("touchstart",function(a){var b=a.target.tagName.toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(b)===-1){a.preventDefault();e.running||a.stopPropagation()}},true);c.addEventListener("touchmove",function(a){var b=a.target.tagName.toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(b)===-1){a.preventDefault();e.running||a.stopPropagation()}},true);c.addEventListener("touchend",
function(a){var b=a.target.tagName.toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(b)===-1){a.preventDefault();e.running||a.stopPropagation()}},true)}else{c.addEventListener("mousedown",function(a){var b=a.target.tagName.toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(b)===-1){a.preventDefault();e._mousedownID++;e.running||a.stopPropagation()}},true);c.addEventListener("mousemove",function(a){var b=a.target.tagName.toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(b)===
-1){a.preventDefault();e.running||a.stopPropagation()}},true);c.addEventListener("mouseup",function(a){var b=a.target.tagName.toLowerCase();if(enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(b)===-1){a.preventDefault();e.running||a.stopPropagation()}},true)}}},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));[].push.apply(this._assets,a)},load:function(a,b){b==null&&(b=function(){});var d=f(a);if(enchant.Game._loadFuncs[d])enchant.Game._loadFuncs[d].call(this,a,b,d);else{var c=
new XMLHttpRequest;c.open("GET",a,true);c.onreadystatechange=function(){if(c.readyState==4){if(c.status!=200&&c.status!=0)throw Error(c.status+": Cannot load an asset: "+a);var d=c.getResponseHeader("Content-Type")||"";if(d.match(/^image/)){e.assets[a]=enchant.Surface.load(a);e.assets[a].addEventListener("load",b)}else if(d.match(/^audio/)){e.assets[a]=enchant.Sound.load(a,d);e.assets[a].addEventListener("load",b)}else{e.assets[a]=c.responseText;b()}}};c.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);
else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!e._touched&&enchant.ENV.VENDOR_PREFIX=="webkit"&&enchant.ENV.TOUCH_ENABLED){var a=new enchant.Scene;a.backgroundColor="#000";var b=Math.round(e.width/10),d=new enchant.Sprite(e.width,b);d.y=(e.height-b)/2;d.image=new enchant.Surface(e.width,b);d.image.context.fillStyle="#fff";d.image.context.font=b-1+"px bold Helvetica,Arial,sans-serif";var c=d.image.context.measureText("Touch to Start").width;d.image.context.fillText("Touch to Start",
(e.width-c)/2,b-1);a.addChild(d);document.addEventListener("touchstart",function(){e._touched=true;e.removeScene(a);e.start()},true);e.pushScene(a);return}var g={},b=this._assets.filter(function(a){return a in g?false:g[a]=true}),n=0,d=0,k=b.length;for(;d<k;d++)this.load(b[d],function(){var a=new enchant.Event("progress");a.loaded=++n;a.total=k;e.dispatchEvent(a);if(n==k){e.removeScene(e.loadingScene);e.dispatchEvent(new enchant.Event("load"))}});this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));
this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},1E3/this.fps);this.running=true},debug:function(){this._debug=true;this.rootScene.addEventListener("enterframe",function(a){this._actualFps=1/a});this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var a=Date.now(),b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime;this.currentTime=a;for(var a=this.currentScene.childNodes.slice(),d=Array.prototype.push;a.length;){var c=
a.pop();c.dispatchEvent(b);c.age++;c.childNodes&&d.apply(a,c.childNodes)}this.currentScene.dispatchEvent(b);this.dispatchEvent(b);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}},resume:function(){this.currentTime=Date.now();this._intervalID=window.setInterval(function(){e._tick()},
1E3/this.fps);this.running=true},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene==this.rootScene)return this.currentScene;this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-
2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(a){this.popScene();return this.pushScene(a)},removeScene:function(a){if(this.currentScene==a)return this.popScene();var b=this._scenes.indexOf(a);if(b!=-1){this._scenes.splice(b,1);this._element.removeChild(a._element);return a}},keybind:function(a,b){this._keybind[a]=b},getElapsedTime:function(){return this.frame/this.fps}});enchant.Game._loadFuncs={};enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=
enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(a,b){this.assets[a]=enchant.Surface.load(a);this.assets[a].addEventListener("load",b)};enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=enchant.Game._loadFuncs.ogg=function(a,b,d){this.assets[a]=enchant.Sound.load(a,"audio/"+d);this.assets[a].addEventListener("load",b)};enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,
{initialize:function(){enchant.EventTarget.call(this);this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.addEventListener("touchstart",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)})},
moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x=this._x+a;this._y=this._y+b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=
this._y}},remove:function(){this._listener&&this.clearEventListener();this.parentNode&&this.parentNode.removeChild(this)}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;if(enchant.Game.instance._debug){this._style.border="1px solid blue";
this._style.margin="-1px"}this.buttonMode=null;this.buttonPressed=false;this.addEventListener("touchstart",function(){if(this.buttonMode){this.buttonPressed=true;var a=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(a);e.dispatchEvent(a)}});this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=false;var a=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(a);e.dispatchEvent(a)}});var a=this,b=function(){a.dispatchEvent(new enchant.Event("render"))};
this.addEventListener("addedtoscene",function(){b();e.addEventListener("exitframe",b)});this.addEventListener("removedfromscene",function(){e.removeEventListener("exitframe",b)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX)this._style.left=this._offsetX+"px";if(this._offsetY!=this._previousOffsetY)this._style.top=this._offsetY+"px";this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});a=this;if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",
function(b){for(var c=b.touches,g=0,n=c.length;g<n;g++){b=new enchant.Event("touchstart");b.identifier=c[g].identifier;b._initPosition(c[g].pageX,c[g].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchmove",function(b){for(var c=b.touches,g=0,n=c.length;g<n;g++){b=new enchant.Event("touchmove");b.identifier=c[g].identifier;b._initPosition(c[g].pageX,c[g].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchend",function(b){for(var c=b.changedTouches,g=0,n=
c.length;g<n;g++){b=new enchant.Event("touchend");b.identifier=c[g].identifier;b._initPosition(c[g].pageX,c[g].pageY);a.dispatchEvent(b)}},false)}else{this._element.addEventListener("mousedown",function(b){var c=b.pageX,g=b.pageY,b=new enchant.Event("touchstart");b.identifier=e._mousedownID;b._initPosition(c,g);a.dispatchEvent(b);a._mousedown=true},false);e._element.addEventListener("mousemove",function(b){if(a._mousedown){var c=b.pageX,g=b.pageY,b=new enchant.Event("touchmove");b.identifier=e._mousedownID;
b._initPosition(c,g);a.dispatchEvent(b)}},false);e._element.addEventListener("mouseup",function(b){if(a._mousedown){var c=b.pageX,g=b.pageY,b=new enchant.Event("touchend");b.identifier=e._mousedownID;b._initPosition(c,g);a.dispatchEvent(b);a._mousedown=false}},false)}},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=
(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){this._style.display=(this._visible=a)?"block":"none"}},touchEnabled:{get:function(){return this._touchEnabled},
set:function(a){this._style.pointerEvents=(this._touchEnabled=a)?"all":"none"}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){b==null&&(b=(this.width+this.height+a.width+a.height)/4);var d;return(d=this.x-a.x+(this.width-a.width)/2)*d+(d=this.y-a.y+(this.height-a.height)/2)*d<b*b},scale:function(a,b){b==null&&(b=a);this._scaleX=this._scaleX*a;this._scaleY=this._scaleY*b;this._dirty=true},rotate:function(a){this._rotation=
this._rotation+a;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=true}}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._scaleY=this._scaleX=1;this._rotation=0;this._dirty=
false;this._image=null;this._frame=0;this._frameSequence=[];this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){this._style[enchant.ENV.VENDOR_PREFIX+"Transform"]=["rotate(",this._rotation,"deg)scale(",this._scaleX,",",this._scaleY,")"].join("");this._dirty=false}});this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var a=this._frameSequence.shift();if(a===null)this._frameSequence=[];else{this._setFrame(a);this._frameSequence.push(a)}}});
if(enchant.Game.instance._debug){this._style.border="1px solid red";this._style.margin="-1px";this.addEventListener("touchstart",function(){enchant.Game.instance.running||console.log("touchstart",this)})}},image:{get:function(){return this._image},set:function(a){if(a!=this._image){if(this._image!=null)if(this._image.css)this._style.backgroundImage="";else if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);
this._dirtyListener=null}else this._image._parent=null}if(a!=null)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=document.createElement("canvas"),d=b.getContext("2d");b.width=a.width;b.height=a.height;d.drawImage(a._element,0,0);this._dirtyListener=function(){if(a._dirty){d.drawImage(a._element);a._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else{a._parent=this;this._element.appendChild(a._element)}this._image=a;this.frame=
this.frame}}},frame:{get:function(){return this._frame},set:function(a){if(a instanceof Array){var b=a.shift();this._setFrame(b);a.push(b);this._frameSequence=a}else{this._setFrame(a);this._frameSequence=[];this._frame=a}}},_setFrame:function(a){if(this._image!=null){this._frame=a;var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var d=this._element.firstChild.style;
d.left=-(a%b)*this._width+"px";d.top=-(a/b|0)*this._height+"px"}}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a;this.textAlign="left"},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},textAlign:{get:function(){return this._style.textAlign},set:function(a){this._style.textAlign=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},
set:function(a){this._style.color=a}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);var d=document.createElement("canvas");if(enchant.ENV.RETINA_DISPLAY&&e.scale==2){d.width=e.width*2;d.height=e.height*2;this._style.webkitTransformOrigin="0 0";this._style.webkitTransform="scale(0.5)"}else{d.width=e.width;d.height=e.height}this._element.appendChild(d);this._context=d.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;
this._data=[[[]]];this.touchEnabled=this._tight=this._dirty=false;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,e.width,e.height)}else if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY)if(this._tight){var a=-this._offsetX,b=-this._offsetY,d=-this._previousOffsetX,k=-this._previousOffsetY,q=a-d+e.width,i=d-a+e.width,j=b-k+e.height,f=k-b+e.height;
if(q>this._tileWidth&&i>this._tileWidth&&j>this._tileHeight&&f>this._tileHeight){var h;if(q<i){h=0;a=d-a;i=q}else{h=a-d;a=0}if(j<f){q=0;b=k-b}else{q=b-k;b=0;j=f}if(e._buffer==null){e._buffer=document.createElement("canvas");e._buffer.width=this._context.canvas.width;e._buffer.height=this._context.canvas.height}f=e._buffer.getContext("2d");if(this._doubledImage){f.clearRect(0,0,i*2,j*2);f.drawImage(this._context.canvas,h*2,q*2,i*2,j*2,0,0,i*2,j*2);f=this._context;f.clearRect(a*2,b*2,i*2,j*2);f.drawImage(e._buffer,
0,0,i*2,j*2,a*2,b*2,i*2,j*2)}else{f.clearRect(0,0,i,j);f.drawImage(this._context.canvas,h,q,i,j,0,0,i,j);f=this._context;f.clearRect(a,b,i,j);f.drawImage(e._buffer,0,0,i,j,a,b,i,j)}a==0?this.redraw(i,0,e.width-i,e.height):this.redraw(0,0,e.width-i,e.height);b==0?this.redraw(0,j,e.width,e.height-j):this.redraw(0,0,e.width,e.height-j)}else this.redraw(0,0,e.width,e.height)}else this.redraw(0,0,e.width,e.height);this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=
Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var b=0,d=this._data.length;b<d;b++){for(var c=0,a=this._data[b],g=0,n=a.length;g<n;g++)for(var e=0,f=a[g].length;e<f;e++)a[g][e]>=0&&c++;if(c/(a.length*a[0].length)>0.2){this._tight=true;break}}},checkTile:function(a,b){if(a<0||this.width<=a||b<0||this.height<=b)return false;var d=this._image.width,c=this._image.height,c=this._tileHeight||c,a=a/(this._tileWidth||d)|0;return this._data[0][b/c|0][a]},hitTest:function(a,b){if(a<
0||this.width<=a||b<0||this.height<=b)return false;var d=this._image.width,c=this._image.height,g=this._tileWidth||d,e=this._tileHeight||c,a=a/g|0,b=b/e|0;if(this.collisionData!=null)return this.collisionData[b]&&!!this.collisionData[b][a];for(var k=0,f=this._data.length;k<f;k++){var i=this._data[k],j;if(i[b]!=null&&(j=i[b][a])!=null&&0<=j&&j<(d/g|0)*(c/e|0))return true}return false},image:{get:function(){return this._image},set:function(a){this._image=a;if(enchant.ENV.RETINA_DISPLAY&&e.scale==2){for(var b=
new enchant.Surface(a.width*2,a.height*2),d=this._tileWidth||a.width,c=this._tileHeight||a.height,g=a.width/d|0,n=a.height/c|0,k=0;k<n;k++)for(var f=0;f<g;f++)b.draw(a,f*d,k*c,d,c,f*d*2,k*c*2,d*2,c*2);this._doubledImage=b}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},
height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,d,c){if(this._image!=null){var g,e,k,f,i;if(this._doubledImage){g=this._doubledImage;e=this._tileWidth*2;k=this._tileHeight*2;f=-this._offsetX*2;i=-this._offsetY*2;a=a*2;b=b*2;d=d*2;c=c*2}else{g=this._image;e=this._tileWidth;k=this._tileHeight;f=-this._offsetX;i=-this._offsetY}var j=g.width/e|0,h=g.height/k|0,l=Math.max((a+f)/e|0,0),m=Math.max((b+i)/k|0,0),o=Math.ceil((a+f+d)/e),p=Math.ceil((b+i+c)/k);g=g._element;
var r=this._context;r.clearRect(a,b,d,c);d=0;for(c=this._data.length;d<c;d++)for(var s=this._data[d],t=Math.min(o,s[0].length),u=Math.min(p,s.length),b=m;b<u;b++)for(a=l;a<t;a++){var v=s[b][a];0<=v&&v<j*h&&r.drawImage(g,v%j*e,(v/j|0)*k,e,k,a*e-f,b*k-i,e,k)}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._y=this._x=0},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));
if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var d=document.createDocumentFragment(),c,g=Array.prototype.push;if(a._element)d.appendChild(a._element);else if(a.childNodes)for(c=a.childNodes.slice().reverse();c.length;){a=c.pop();a.scene=this.scene;a.dispatchEvent(b);a._element?d.appendChild(a._element):a.childNodes&&g.apply(c,a.childNodes.reverse())}if(d.childNodes.length){for(var e,b=this;b.parentNode;){c=b.parentNode.childNodes;
for(c=c.slice(c.indexOf(b)+1).reverse();c.length;){a=c.pop();if(a._element){e=a._element;break}else a.childNodes&&g.apply(c,a.childNodes.slice().reverse())}b=b.parentNode}e?this.scene._element.insertBefore(d,e):this.scene._element.appendChild(d)}}},insertBefore:function(a,b){var d=this.childNodes.indexOf(b);if(d!=-1){this.childNodes.splice(d,0,a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var c=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(c);
a._updateCoordinate();var g=document.createDocumentFragment(),e,f=Array.prototype.push;if(a._element)g.appendChild(a._element);else if(a.childNodes)for(e=a.childNodes.slice().reverse();e.length;){a=e.pop();a.scene=this.scene;a.dispatchEvent(c);a._element?g.appendChild(a._element):a.childNodes&&f.apply(e,a.childNodes.reverse())}if(g.childNodes.length){for(var h,c=b;c!=this;){if(d!=null){e=this.childNodes.slice(d+1).reverse();d=null}else{e=c.parentNode.childNodes;e=e.slice(e.indexOf(c)+1).reverse()}for(;e.length;){a=
e.pop();if(a._element){h=a._element;break}else a.childNodes&&f.apply(e,a.childNodes.slice().reverse())}c=c.parentNode}h?this.scene._element.insertBefore(g,h):this.scene._element.appendChild(g)}}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(b!=-1){this.childNodes.splice(b,1);a.parentNode=null;a.dispatchEvent(new enchant.Event("removed"));if(this.scene){b=new enchant.Event("removedfromscene");a.scene=null;a.dispatchEvent(b);if(a._element)this.scene._element.removeChild(a._element);
else if(a.childNodes)for(var d=a.childNodes.slice(),c=Array.prototype.push;d.length;){a=d.pop();a.scene=null;a.dispatchEvent(b);a._element?this.scene._element.removeChild(a._element):a.childNodes&&c.apply(d,a.childNodes)}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=
this._x;this._offsetY=this._y}for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});enchant.RGroup=enchant.Class.create(enchant.Group,{initialize:function(a,b){enchant.Group.call(this);if(arguments.length<2)throw"Width and height of RGroup must be specified";this.width=a;this.height=b;this.rotationOrigin={x:a/2,y:b/2};this._rotation=0},addChild:function(a){enchant.Group.prototype.addChild.apply(this,arguments);a.transformOrigin="0 0"},rotation:{get:function(){return this._rotation},
set:function(a){var b=a-this._rotation;if(b!=0){for(var d=b/180*Math.PI,c=Math.sin(d),d=Math.cos(d),e=this.width/2,n=this.height/2,f=0,h=this.childNodes.length;f<h;f++){var i=this.childNodes[f];i.rotation=i.rotation-b;var j=i.x-e,l=i.y-n;i.x=+d*j+c*l+e;i.y=-c*j+d*l+n}this._rotation=a}}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";
this._element.style.width=(this.width=e.width)+"px";this._element.style.height=(this.height=e.height)+"px";this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0";this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+e.scale+")";this.scene=this;var a=this;if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",function(b){for(var d=b.touches,c=0,e=d.length;c<e;c++){b=new enchant.Event("touchstart");b.identifier=d[c].identifier;b._initPosition(d[c].pageX,
d[c].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchmove",function(b){for(var d=b.touches,c=0,e=d.length;c<e;c++){b=new enchant.Event("touchmove");b.identifier=d[c].identifier;b._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchend",function(b){for(var d=b.changedTouches,c=0,e=d.length;c<e;c++){b=new enchant.Event("touchend");b.identifier=d[c].identifier;b._initPosition(d[c].pageX,d[c].pageY);a.dispatchEvent(b)}},false)}else{this._element.addEventListener("mousedown",
function(b){var d=b.pageX,c=b.pageY,b=new enchant.Event("touchstart");b.identifier=e._mousedownID;b._initPosition(d,c);a.dispatchEvent(b);a._mousedown=true},false);e._element.addEventListener("mousemove",function(b){if(a._mousedown){var d=b.pageX,c=b.pageY,b=new enchant.Event("touchmove");b.identifier=e._mousedownID;b._initPosition(d,c);a.dispatchEvent(b)}},false);e._element.addEventListener("mouseup",function(b){if(a._mousedown){var d=b.pageX,c=b.pageY,b=new enchant.Event("touchend");b.identifier=
e._mousedownID;b._initPosition(d,c);a.dispatchEvent(b);a._mousedown=false}},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});var E=["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"];
enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);this.width=a;this.height=b;this.context=null;var d="enchant-surface"+e._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",d,a,b);this._element=this.context.canvas;this._css="-webkit-canvas("+d+")"}else if(document.mozSetImageElement){this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._css="-moz-element(#"+
d+")";this.context=this._element.getContext("2d");document.mozSetImageElement(d,this._element)}else{this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._element.style.position="absolute";this.context=this._element.getContext("2d");E.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=true}},this)}},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,d,c,e,n){var f=
this.context.createImageData(1,1);f.data[0]=d;f.data[1]=c;f.data[2]=e;f.data[3]=n;this.context.putImageData(f,a,b)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;arguments.length==1?this.context.drawImage(a,0,0):this.context.drawImage.apply(this.context,arguments)},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=this._element.src;return a?a.slice(0,5)=="data:"?a:this.clone().toDataURL():
this._element.toDataURL()}});enchant.Surface.load=function(a){var b=new Image,d=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(d);b.src=a;b.onerror=function(){throw Error("Cannot load an asset: "+b.src);};b.onload=function(){d.width=b.width;d.height=b.height;d.dispatchEvent(new enchant.Event("load"))};return d};var t=[],s=null,w=function(a){for(var b=enchant.Game.instance,d,c=t.length-1;c>=0;c--){d=t[c];if(d.scene==
b.currentScene&&d._touchstartPropagation(a)){s=d;break}}},x=function(a){s!=null&&s._touchmovePropagation(a)},y=function(a){if(s!=null){s._touchendPropagation(a);s=null}};if(enchant.widget)enchant.widget.EntityGroup.prototype.cvsRender=function(a){this.background&&(this.background._element.width>0&&this.background._element.height>0)&&a.drawImage(this.background._element,0,0,this.width+0,this.height+0);a.beginPath();a.rect(0,0,this.width,this.height);a.clip()};enchant.Map.prototype.cvsRender=function(a){var b=
enchant.Game.instance;a.save();a.setTransform(1,0,0,1,0,0);a.drawImage(this._element.firstChild,0,0,b.width,b.height);a.restore()};enchant.Sprite.prototype.cvsRender=function(a){var b,d,c,e,f;if(this._image){e=Math.abs(this._frame)||0;b=this._image;d=b._element;c=b.width/this._width|0;f=e%c*this._width;c=(e/c|0)*this._height%b.height;c=Math.min(c,b.height-this._height);e=Math.min(b.width-f,this._width);b=Math.min(b.height-c,this._height);a.drawImage(d,f,c,e,b,0,0,this._width+0,this._height+0)}};enchant.Label.prototype.cvsRender=
function(a){if(this.text){a.textBaseline="top";a.font=this.font;a.fillStyle=this.color||"#000000";a.fillText(this.text,0,0,this.width+0)}};var F=enchant.Class.create({initialize:function(a,b){this.reference=[];this.detectColorNum=0;this.colorResolution=a||16;this.max=b||1},attachDetectColor:function(a){this.detectColorNum=this.detectColorNum+1;this.reference[this.detectColorNum]=a;return this._createNewColor()},detachDetectColor:function(a){a=this.reference.indexOf(a);a!=-1&&(this.reference[a]=null)},
_createNewColor:function(){var a=this.detectColorNum,b=this.colorResolution,d=b/this.max;return[parseInt(a/b/b%b)/d,parseInt(a/b%b)/d,parseInt(a%b)/d,1]},_decodeDetectColor:function(a){var b=this.colorResolution;return~~(a[0]*b*b*b/256)+~~(a[1]*b*b/256)+~~(a[2]*b/256)},getSpriteByColor:function(a){return this.reference[this._decodeDetectColor(a)]}}),l=function(a,b){var a=a||function(){},b=b||function(){},d=function(){a.apply(this,arguments);var c;if(this.childNodes)for(var e=0,f=this.childNodes.length;e<
f;e++){c=this.childNodes[e];d.apply(c,arguments)}b.apply(this,arguments)};return d},z=function(a){if(a.__dirty||a._cvsCache.x!=a.x||a._cvsCache.y!=a.y||a._cvsCache.width!=a.width||a._cvsCache.height!=a.height){var b=a._cvsCache.matrix,d=a.x,c=a.y,e=a.width||0,f=a.height||0,k=typeof a.scaleX=="number"?a.scaleX:1,h=typeof a.scaleY=="number"?a.scaleY:1,i=Math.PI*(a.rotation||0)/180,j=Math.cos(i),i=Math.sin(i),e=typeof a.originX=="number"?a.originX:e/2,f=typeof a.originY=="number"?a.originY:f/2;b[0]=
k*j;b[1]=k*i;b[2]=-h*i;b[3]=h*j;b[4]=-(k*j)*e+h*i*f+d+e;b[5]=-(k*i)*e-h*j*f+c+f;a.__dirty=false;a._cvsCache.x=a.x;a._cvsCache.y=a.y;a._cvsCache.width=a.width;a._cvsCache.height=a.height}},G=l(function(a){a.save();a.globalCompositeOperation=this.alphaBlending?this.alphaBlending:"source-atob";a.globalAlpha=this.opacity||1;z(this);a.transform.apply(a,this._cvsCache.matrix);var b=enchant.Game.instance;if(this.backgroundColor){a.fillStyle=this.backgroundColor;a.fillRect(0,0,this.width+0,this.height+0)}this.cvsRender&&
this.cvsRender(a);if(b._debug){a.strokeStyle=this instanceof enchant.Label||this instanceof enchant.Sprite?"#ff0000":"#0000ff";a.strokeRect(0,0,this.width+0,this.height+0)}},function(a){a.restore()}),H=l(function(a){a.save();z(this);a.transform.apply(a,this._cvsCache.matrix);a.fillStyle=this._cvsCache.detectColor;a.fillRect(0,0,this.width,this.height)},function(a){a.restore()}),A=function(){this.__dirty=this._dirty?true:false},B=function(a){if(!this._cvsCache){this.addEventListener("render",A);this._cvsCache=
{};this._cvsCache.matrix=[];var b=this._cvsCache,a=a.attachDetectColor(this),a="#"+("00"+Number(parseInt(a[0])).toString(16)).slice(-2)+("00"+Number(parseInt(a[1])).toString(16)).slice(-2)+("00"+Number(parseInt(a[2])).toString(16)).slice(-2);b.detectColor=a}},I=l(function(a){B.call(this,a)}),C=l(function(a,b){this.dispatchEvent(a);B.call(this,b)}),J=l(function(a,b){this.dispatchEvent(a);if(this._cvsCache){this.removeEventListener("render",A);b.detachDetectColor(this);delete this._cvsCache}});l(function(a){this.dispatchEvent(a)});
var u=function(a,b){this.dispatchEvent(a);this.parentNode&&this.parentNode!=b&&u.call(this.parentNode,a,b)};enchant.CanvasGroup=enchant.Class.create(enchant.Group,{initialize:function(){var a=enchant.Game.instance,b=this;enchant.Group.call(this);this._dirty=false;this._rotation=0;this._cvsCache={};this._cvsCache.matrix=[1,0,0,1,0,0];this._cvsCache.detectColor="#000000";this.width=a.width;this.height=a.height;[enchant.Event.ADDED_TO_SCENE,enchant.Event.REMOVED_FROM_SCENE].forEach(function(a){this.addEventListener(a,
function(a){this.childNodes.forEach(function(b){b.scene=this.scene;b.dispatchEvent(a)},this)})},this);this._element=document.createElement("canvas");this._element.width=a.width;this._element.height=a.height;this._element.style.position="absolute";this._detect=document.createElement("canvas");this._detect.width=a.width;this._detect.height=a.height;this._detect.style.position="absolute";this.context=this._element.getContext("2d");this._dctx=this._detect.getContext("2d");this._colorManager=new F(16,
256);if(enchant.ENV.TOUCH_ENABLED){this._element.addEventListener("touchstart",function(a){for(var d=a.touches,e=0,f=d.length;e<f;e++){a=new enchant.Event("touchstart");a.identifier=d[e].identifier;a._initPosition(d[e].pageX,d[e].pageY);w.call(b,a)}},false);this._element.addEventListener("touchmove",function(a){for(var d=a.touches,e=0,f=d.length;e<f;e++){a=new enchant.Event("touchmove");a.identifier=d[e].identifier;a._initPosition(d[e].pageX,d[e].pageY);x.call(b,a)}},false);this._element.addEventListener("touchend",
function(a){for(var d=a.changedTouches,e=0,f=d.length;e<f;e++){a=new enchant.Event("touchend");a.identifier=d[e].identifier;a._initPosition(d[e].pageX,d[e].pageY);y.call(b,a)}},false)}else{this._element.addEventListener("mousedown",function(c){var d=c.pageX,e=c.pageY,c=new enchant.Event("touchstart");c.identifier=a._mousedownID;c._initPosition(d,e);w.call(b,c);b._mousedown=true},false);a._element.addEventListener("mousemove",function(c){if(b._mousedown){var d=c.pageX,e=c.pageY,c=new enchant.Event("touchmove");
c.identifier=a._mousedownID;c._initPosition(d,e);x.call(b,c)}},false);a._element.addEventListener("mouseup",function(c){if(b._mousedown){var d=c.pageX,e=c.pageY,c=new enchant.Event("touchend");c.identifier=a._mousedownID;c._initPosition(d,e);y.call(b,c);b._mousedown=false}},false)}var d=[enchant.Event.EXIT,enchant.Event.REMOVED_FROM_SCENE];[enchant.Event.ENTER,enchant.Event.ADDED_TO_SCENE].forEach(function(a){this.addEventListener(a,this._startRendering);this.addEventListener(a,function(){t.push(this)})},
this);d.forEach(function(a){this.addEventListener(a,this._stopRendering);this.addEventListener(a,function(){var a=t.indexOf(this);a!=-1&&t.splice(a,1)})},this);this._onexitframe=function(){var c=b.context;c.clearRect(0,0,a.width,a.height);I.call(b,b._colorManager);G.call(b,c)}},_startRendering:function(){var a=enchant.Game.instance;a._listeners.exitframe||(a._listeners.exitframe=[]);a._listeners.exitframe.push(this._onexitframe)},_stopRendering:function(){enchant.Game.instance.removeEventListener("exitframe",
this._onexitframe)},_getEntityByPosition:function(a,b){var d=this._dctx;d.clearRect(0,0,this.width,this.height);H.call(this,d);d=d.getImageData(a,b,1,1).data;return this._colorManager.getSpriteByColor(d)},_touchstartPropagation:function(a){var b=this._getEntityByPosition(a.x,a.y);if(b){this._touching=b;u.call(this._touching,a,this.parentNode)}else b=null;return b},_touchmovePropagation:function(a){this._touching!=null&&u.call(this._touching,a,this.parentNode)},_touchendPropagation:function(a){if(this._touching!=
null){u.call(this._touching,a,this.parentNode);this._touching=null}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=true}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=true}},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){a.scene=this.scene;var b=
new enchant.Event("addedtoscene");C.call(a,b,this._colorManager)}},insertBefore:function(a,b){var d=this.childNodes.indexOf(b);if(d!=-1){this.childNodes.splice(d,0,a);a.dispatchEvent(new enchant.Event("added"));if(this.scene){a.scene=this.scene;d=new enchant.Event("addedtoscene");C.call(a,d,this._colorManager)}}else this.addChild(a)},removeChild:function(a){var b;(b=this.childNodes.indexOf(a))!=-1&&this.childNodes.splice(b,1);a.parentNode=null;a.dispatchEvent(new enchant.Event("removed"));if(this.scene){a.scene=
null;b=new enchant.Event("removedfromscene");J.call(a,b,this._colorManager)}}});enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);throw Error("Illegal Constructor");},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio)a=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(false)},
duration:{value:this.duration}});else{if(enchant.ENV.USE_FLASH_SOUND)return this;a=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element)this._element.currentTime=a}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element)this._element.volume=a}}});enchant.Sound.load=function(a,b){if(b==null)var d=f(a),b=d?"audio/"+d:"";
var b=b.replace("mp3","mpeg").replace("m4a","mp4"),c=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(c);var g=new Audio;if(!enchant.Sound.enabledInMobileSafari&&enchant.ENV.VENDOR_PREFIX=="webkit"&&enchant.ENV.TOUCH_ENABLED)window.setTimeout(function(){c.dispatchEvent(new enchant.Event("load"))},0);else if(!enchant.ENV.USE_FLASH_SOUND&&g.canPlayType(b)){g.src=a;g.load();g.autoplay=false;g.onerror=function(){throw Error("Cannot load an asset: "+g.src);};g.addEventListener("canplaythrough",
function(){c.duration=g.duration;c.dispatchEvent(new enchant.Event("load"))},false);c._element=g}else if(b=="audio/mpeg"){var h=document.createElement("embed"),d="enchant-audio"+e._soundID++;h.width=h.height=1;h.name=d;h.src="sound.swf?id="+d+"&src="+a;h.allowscriptaccess="always";h.style.position="absolute";h.style.left="-1px";c.addEventListener("load",function(){Object.defineProperties(h,{currentTime:{get:function(){return h.getCurrentTime()},set:function(a){h.setCurrentTime(a)}},volume:{get:function(){return h.getVolume()},
set:function(a){h.setVolume(a)}}});c._element=h;c.duration=h.getDuration()});e._element.appendChild(h);enchant.Sound[d]=c}else window.setTimeout(function(){c.dispatchEvent(new enchant.Event("load"))},0);return c};window.addEventListener("message",function(a){try{var b=JSON.parse(a.data);if(b.type=="event")enchant.Game.instance.dispatchEvent(new Event(b.value));else if(b.type=="debug")switch(b.value){case "start":enchant.Game.instance.start();break;case "pause":enchant.Game.instance.pause();break;
case "resume":enchant.Game.instance.resume();break;case "tick":enchant.Game.instance._tick()}}catch(d){}},false);enchant.Sound.enabledInMobileSafari=false})();
